!function(e,t){if("function"==typeof define&&define.amd)define(["exports","react","../context","immutable"],t);else if("undefined"!=typeof exports)t(exports,require("react"),require("../context"),require("immutable"));else{var n={exports:{}};t(n.exports,e.react,e.context,e.immutable),e.curlHook=n.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,(function(e,t,n,r){"use strict";function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,u=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw u}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.defineProperty(e,"__esModule",{value:!0}),e.useCurl=void 0;var i={};e.useCurl=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=(0,t.useState)({fetching:(0,r.Map)()}),f=o(c,2),a=f[0],l=f[1],s=(0,t.useRef)(!0),d=(0,t.useContext)(n.CurlContext),h=d.auth,m=void 0===h?function(){return!0}:h,g=d.curl,p=e?m:function(){return!0},v=function(e,t,n){s.current?e?t(e):t():n()},y=function(e,t){s.current?t(e):t()},w=function(){return!s.current||!p()},b=function(e){l((function(t){return{fetching:t.fetching.delete(e)}}))},x=function(e){return setTimeout((function(){if(u){if(w())return e;l((function(t){return{fetching:t.fetching.set(e,!!e)}})),Promise.all([e]).then((function(t){w()||b(e)})).catch((function(t){w()||b(e)}))}})),e},P=function(e,t,n,r){return function(o){if(!r||r===i[n])return v(o,e,t);t()}},T=function(e,t,n){return function(r){if(!n||n===i[t])return y(r,e);e()}},j=(0,t.useRef)({request:function(e,t){return x(new Promise((function(n,r){var o;w()?r():(t&&(o=(new Date).getTime(),i[t]=o),g.request(e).then(P(n,r,t,o)).catch(T(r,t,o)))})))},get:function(e,t,n,r){return x(new Promise((function(o,u){var c;w()?u():(r&&(c=(new Date).getTime(),i[r]=c),g.get(e,t,n).then(P(o,u,r,c)).catch(T(u,r,c)))})))},post:function(e,t,n,r){return x(new Promise((function(o,u){var c;w()?u():(r&&(c=(new Date).getTime(),i[r]=c),g.post(e,t,n).then(P(o,u,r,c)).catch(T(u,r,c)))})))},download:function(e,t,n){return new Promise((function(r,o){p()?g.download(e,t,n):o()}))},ajaxDownload:function(e,t,n){return new Promise((function(r,o){p()?g.ajaxDownload(e,t,n):o()}))},upload:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return x(new Promise((function(u,c){var f;w()?c():(o&&(f=(new Date).getTime(),i[o]=f),g.upload(e,t,n,r).then(P(u,c,o,f)).catch(T(c,o,f)))})))},createLink:function(e,t,n,r){return x(new Promise((function(o,u){var c;w()?u():(r&&(c=(new Date).getTime(),i[r]=c),g.createLink(e,t,n).then(P(o,u,r,c)).catch(T(u,r,c)))})))}});return(0,t.useEffect)((function(){return function(){s.current=!1}}),[]),{curl:j.current,fetching:a.fetching}}}));